
# 超大规模文件扫描与解析性能评估报告（合并CPU限速版）

**对象**：10 台 Windows 服务器；CPU：Intel Xeon Gold 6242R / 6258R；容器配 16 vCPU；Java 程序 20 线程，Tika；关键字≤900；网络路径扫描。  
**规模**：总文件量约 **15 亿**；部分目录深度 > 8，且某些目录文件数 > 5000 万。  
**拆分**：按顶层目录深度=2 切分，子目录平均分配至 10 台服务器并行执行。

---

## 1. 结论速览
- 典型场景（S2：64KB/文件，35% Tika）：**基线**单台一次全量约 **6.47 天**；**限速 10GHz** 时：  
  - 6242R(3.1)：约 **10.23 天**（延长×1.58）  
  - 6258R(2.7)：约 **9.62 天**（延长×1.49）
- **单台最大处理能力（TB/天）** 在限速下降低明显，CPU 占比越高的场景（S3）下降越多。

---

## 2. 基线：单台最大处理能力（files/s、MB/s、TB/天）与一次任务时长

| 场景 | 平均文件大小(KB) | 每文件IO(s) | 每文件CPU(s) | 每文件总(s) | 单机吞吐(files/s) | 单机有效吞吐(MB/s) | 单机最大处理量(TB/天) | 单机一次任务(天) |
| --- | --- | --- | --- | --- | --- | --- | --- | --- |
| S1-小文件为主（日志/文本） | 4 | 0.00301 | 4e-06 | 0.003014 | 331.821 | 1.296 | 0.107 | 5.23 |
| S2-混合体量（文本+部分Office/PDF） | 64 | 0.003179 | 0.000547 | 0.003725 | 268.424 | 16.777 | 1.382 | 6.47 |
| S3-文档为主（Office/PDF图文混排） | 256 | 0.006 | 0.0075 | 0.0135 | 74.074 | 18.519 | 1.526 | 23.44 |

> 注：此处“最大处理量”是按该场景特征长期稳定运行的**有效吞吐**估计（综合元数据枚举、网络传输与 Tika CPU 解析）。

---

## 3. 限速 10GHz：单台最大处理能力与一次任务时长（合并 6242R/6258R）

| CPU型号(16vCPU) | 场景 | CPU限速 | CPU放大系数(M) | 新-每文件总(s) | 单机吞吐(files/s) | 单机有效吞吐(MB/s) | 单机最大处理量(TB/天) | 单机一次任务(天) | 延长倍数(相对基线) |
| --- | --- | --- | --- | --- | --- | --- | --- | --- | --- |
| 6242R(3.1GHz) | S1-小文件为主（日志/文本） | 10 GHz | 4.96 | 0.003029 | 330.127 | 1.29 | 0.106 | 5.26 | 1.01 |
| 6258R(2.7GHz) | S1-小文件为主（日志/文本） | 10 GHz | 4.32 | 0.003027 | 330.399 | 1.291 | 0.106 | 5.25 | 1.0 |
| 6242R(3.1GHz) | S2-混合体量（文本+部分Office/PDF） | 10 GHz | 4.96 | 0.005891 | 169.748 | 10.609 | 0.874 | 10.23 | 1.58 |
| 6258R(2.7GHz) | S2-混合体量（文本+部分Office/PDF） | 10 GHz | 4.32 | 0.005541 | 180.471 | 11.279 | 0.929 | 9.62 | 1.49 |
| 6242R(3.1GHz) | S3-文档为主（Office/PDF图文混排） | 10 GHz | 4.96 | 0.0432 | 23.148 | 5.787 | 0.477 | 75.0 | 3.2 |
| 6258R(2.7GHz) | S3-文档为主（Office/PDF图文混排） | 10 GHz | 4.32 | 0.0384 | 26.042 | 6.51 | 0.536 | 66.67 | 2.84 |

**计算口径**：仅对 **CPU 部分（Tika 重解析）**按算力线性放大；IO 与元数据保持不变。  
**M = 基线算力 / 10GHz**：6242R 为 49.6/10≈4.96，6258R 为 43.2/10≈4.32。

---

## 4. 架构与调度建议（限速场景）
- **降低 Tika 命中率**：扩展名白名单直读、MIME/魔数快速分流、大 PDF 只取文本层。  
- **CPU 时间削减**：禁用不必要 parser、限制解析页数/大小、池化 parser、升级 JRE/Tika。  
- **均衡切分+抢占**：对超大目录（>5000 万）二次切分，启用任务抢占（work stealing）降低拖尾。  
- **线程与堆**：限速下解析线程收敛到 **8–12** 更佳，`-Xmx` 保持 20G 左右，观察 GC 指标动态微调。

---

## 5. 计算公式（摘要）
- 单文件：\( t_{file} = t_{meta} + t_{xfer} + p_h\cdot t_{tika} \)  
- 吞吐：\(\text{files/s} = 1/t_{file}\)，\(\text{TB/天} = \text{files/s}\times \bar s\times 86400/1024^2\)  
- 限速：\( t_{file,cap} = t_{IO} + M\cdot t_{CPU} \)

---

**备注**：建议用 100–1000 万文件样本测得实际 \(t_{meta}, B, c_h, p_h\)，回填上述表格以锁定生产窗口。
